// Generated by CoffeeScript 2.5.1
var indexOf = [].indexOf;

import {
  Api
} from './api.js';

export var runRollup = function() {
  if (indexOf.call(Deno.args, '--watch') >= 0) {
    Deno.run({
      cmd: "bash rollup -w -c .config/rollup.config.mjs".split(' ')
    });
  }
  Deno.permissions.revoke({
    name: 'run'
  });
  return Deno.permissions.revoke({
    name: 'env'
  });
};

export var serveBundles = function({path}) {
  return Api.staticStack.push(async function(context, next) {
    var jspath;
    jspath = context.request.url.pathname === '/' ? '/index.js' : context.request.url.pathname + '.js';
    if ((await Deno.stat(path + jspath).then(function(x) {
      return true;
    }).catch(function() {
      return false;
    }))) {
      console.log('serving module', path + jspath);
      return context.response.html = `<script src='${jspath}' type='module'></script>`;
    } else {
      return next();
    }
  });
};
